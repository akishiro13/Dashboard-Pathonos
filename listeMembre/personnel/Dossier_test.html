<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Dossier SCP v2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --font-mono: 'Courier New', Courier, monospace; --scp-red: #8a0000; }
        body { font-family: var(--font-mono); background-color: #121212; color: #eee; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* --- INTERFACE GENERATEUR (A) --- */
        #gen-ui { background: #222; border: 2px solid var(--scp-red); padding: 25px; width: 100%; max-width: 900px; margin-bottom: 40px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .group { display: flex; flex-direction: column; margin-bottom: 10px; }
        label { font-size: 0.75rem; color: var(--scp-red); font-weight: bold; text-transform: uppercase; margin-bottom: 4px; }
        input, textarea, select { background: #000; border: 1px solid #444; color: #0f0; padding: 8px; font-family: var(--font-mono); }
        .btn-save { background: var(--scp-red); color: white; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 20px; text-transform: uppercase; }
        
        /* --- FICHE FINALE (B) --- */
        #final-folder { background: #fff; color: #000; padding: 50px; width: 100%; max-width: 850px; border: 1px solid #000; box-sizing: border-box; }
        .header-top { border-bottom: 3px solid #000; display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
        .black-bar { background: #000; color: #fff; text-align: center; padding: 6px; font-weight: bold; margin: 20px 0; text-transform: uppercase; letter-spacing: 2px; }
        .section-title { background: #e0e0e0; border: 1px solid #000; padding: 5px 10px; font-weight: bold; margin-top: 25px; text-transform: uppercase; }
        .data-row { display: flex; border-bottom: 1px dashed #999; padding: 6px 0; align-items: baseline; }
        .data-label { width: 220px; font-weight: bold; text-transform: uppercase; font-size: 0.85em; }
        .data-val { flex: 1; font-weight: normal; }
        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 0; border: 1px solid #000; margin-top: 15px; }
        .photo-area { border-left: 1px solid #000; background: #f9f9f9; display: flex; align-items: center; justify-content: center; }
        #out_img { max-width: 100%; height: auto; filter: grayscale(100%) contrast(1.2); }
        .perf-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; border: 1px solid #000; padding: 15px; }
        .score-zone { border: 4px double #000; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        
        @media print { #gen-ui { display: none; } }
    </style>
</head>
<body>

    

    <div id="final-folder">
        <div class="header-top">
            <div>
                <div style="font-weight:bold; font-size:1.2em">SCP FOUNDATION PERSONNEL FILE</div>
                <div style="font-size:0.8em">DEPARTEMENT DES ARCHIVES DU SITE-80</div>
            </div>
            <div style="font-size:40px">⎔</div>
        </div>

        <div class="black-bar">CONFIDENTIEL - ACCRÉDITATION <span id="out_lvl_bar">test</span> REQUISE</div>

        <div class="main-grid">
            <div style="padding:15px">
                <div class="section-title" style="margin-top:0">IDENTIFICATION DU SUJET</div>
                <div class="data-row"><div class="data-label">NOM COMPLET:</div><div class="data-val" id="out_nom">test</div></div>
                <div class="data-row"><div class="data-label">ID SCIPNET:</div><div class="data-val" id="out_id">test</div></div>
                <div class="data-row"><div class="data-label">POSTE:</div><div class="data-val" id="out_poste">Chercheur Junior</div></div>
                <div class="data-row"><div class="data-label">NIVEAU D'ACCRÉDITATION:</div><div class="data-val" id="out_lvl">test</div></div>
                
                <div class="section-title">DONNÉES BIOMÉTRIQUES</div>
                <div class="data-row"><div class="data-label">SEXE:</div><div class="data-val" id="out_sexe">Masculin</div></div>
                <div class="data-row"><div class="data-label">DATE DE NAISSANCE:</div><div class="data-val" id="out_ddn">23/11/1999</div></div>
                <div class="data-row"><div class="data-label">NATIONALITÉ:</div><div class="data-val" id="out_nat">Française</div></div>
                <div class="data-row"><div class="data-label">ETHNICITÉ:</div><div class="data-val" id="out_eth">Caucasien</div></div>
            </div>
            <div class="photo-area">
                <img id="out_img" src="https://via.placeholder.com/300x400?text=AUCUNE+IMAGE" alt="Photo">
            </div>
        </div>

        <div class="section-title">AFFECTATIONS ACTUELLES</div>
        <div id="out_aff" style="white-space: pre-wrap; padding:10px; font-size:0.9em; border:1px solid #000; border-top:none">Secteur Scientifique<br>Secteur de Confinement</div>

        <div class="section-title">RAPPORT MÉDICAL ET PSYCHOLOGIQUE</div>
        <div id="out_med" style="white-space: pre-wrap; padding:10px; font-size:0.9em; border:1px solid #000; border-top:none">Physique : RAS<br>Psychologique : Stable, légère paranoïa liée au site.</div>

        <div class="section-title">ÉVALUATION DES COMPÉTENCES (RADAR)</div>
        <div class="perf-grid">
            <div class="score-zone">
                <div style="font-size:0.8em; font-weight:bold">RÉSULTAT GLOBAL</div>
                <div style="font-size:3.5em; font-weight:bold" id="out_global">83%</div>
                <div style="letter-spacing:5px; font-size:0.9em">STATUT: OPTIMAL</div>
            </div>
            <div style="height: 250px;"><canvas id="perfChart" style="display: block; box-sizing: border-box; height: 250px; width: 250px;" width="312" height="312"></canvas></div>
        </div>
    </div>

    <script>
        let chart;
        function sync() {
            document.getElementById('out_nom').innerText = document.getElementById('in_nom').value;
            document.getElementById('out_lvl').innerText = document.getElementById('in_lvl').value;
            document.getElementById('out_lvl_bar').innerText = document.getElementById('in_lvl').value;
            document.getElementById('out_id').innerText = document.getElementById('in_id').value;
            document.getElementById('out_poste').innerText = document.getElementById('in_poste').value;
            document.getElementById('out_sexe').innerText = document.getElementById('in_sexe').value;
            document.getElementById('out_nat').innerText = document.getElementById('in_nat').value;
            document.getElementById('out_eth').innerText = document.getElementById('in_eth').value;
            document.getElementById('out_ddn').innerText = document.getElementById('in_ddn').value;
            document.getElementById('out_aff').innerText = document.getElementById('in_aff').value;
            document.getElementById('out_med').innerText = document.getElementById('in_med').value;

            const scores = [document.getElementById('s1').value, document.getElementById('s2').value, document.getElementById('s3').value, document.getElementById('s4').value, document.getElementById('s5').value, document.getElementById('s6').value];
            
            if(chart) {
                chart.data.datasets[0].data = scores;
                chart.update();
            } else {
                chart = new Chart(document.getElementById('perfChart'), {
                    type: 'radar',
                    data: {
                        labels: ['ACP', 'RADA', 'CMC', 'OSA', 'IACS', 'IAAI'],
                        datasets: [{ data: scores, backgroundColor: 'rgba(0,0,0,0.1)', borderColor: '#000', borderWidth: 2 }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 100, ticks: { display: false } } } }
                });
            }
        }

        function loadImg(e) {
            const reader = new FileReader();
            reader.onload = function(){ document.getElementById('out_img').src = reader.result; };
            reader.readAsDataURL(e.target.files[0]);
        }

        function savePure() {
            const scores = chart.data.datasets[0].data.join(',');
            const photoSrc = document.getElementById('out_img').src;
            let clone = document.documentElement.cloneNode(true);
            clone.querySelector('#gen-ui').remove();
            
            const finalHtml = `<!DOCTYPE html>
<html lang="fr">
${clone.innerHTML}
<script>
    window.onload = () => {
        new Chart(document.getElementById('perfChart'), {
            type: 'radar',
            data: {
                labels: ['ACP', 'RADA', 'CMC', 'OSA', 'IACS', 'IAAI'],
                datasets: [{ data: [${scores}], backgroundColor: 'rgba(0,0,0,0.1)', borderColor: '#000', borderWidth: 2 }]
            },
            options: { plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 100, ticks: { display: false } } } }
        });
    }
<\/script>
</html>`;

            const blob = new Blob([finalHtml], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "Dossier_" + document.getElementById('in_nom').value + ".html";
            a.click();
        }
        window.onload = sync;
    </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>

</body>
<script>
    window.onload = () => {
        new Chart(document.getElementById('perfChart'), {
            type: 'radar',
            data: {
                labels: ['ACP', 'RADA', 'CMC', 'OSA', 'IACS', 'IAAI'],
                datasets: [{ data: [84,52,80,56,80,99], backgroundColor: 'rgba(0,0,0,0.1)', borderColor: '#000', borderWidth: 2 }]
            },
            options: { plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 100, ticks: { display: false } } } }
        });
    }
</script>
</html>