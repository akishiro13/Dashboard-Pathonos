<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGENCY PERFORMANCE METRICS // CLASSIFIED</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #e0e0e0;
            --bar-color: #000000;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            border: 2px solid var(--text-color);
            padding: 20px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
        }

        h1, h2, h3 {
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 0;
        }

        .header-box {
            border-bottom: 2px solid var(--text-color);
            margin-bottom: 30px;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        /* Input Styling */
        .agent-input-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f0f0;
            border: 1px dashed black;
        }
        
        input[type="text"] {
            background: transparent;
            border: none;
            border-bottom: 2px solid black;
            font-family: inherit;
            font-size: 1.2rem;
            width: 300px;
            text-transform: uppercase;
            font-weight: bold;
            outline: none;
        }

        /* Form Styling */
        .category-section {
            margin-bottom: 40px;
            border-left: 4px solid var(--text-color);
            padding-left: 15px;
        }

        .question-row {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dotted #ccc;
        }

        .scale-selector {
            display: flex;
            justify-content: space-between;
            max-width: 300px;
            margin-top: 5px;
        }

        .scale-selector label {
            cursor: pointer;
            font-weight: bold;
        }

        input[type="radio"] {
            accent-color: black;
        }

        button {
            background-color: var(--text-color);
            color: var(--bg-color);
            border: none;
            padding: 15px 30px;
            font-family: inherit;
            font-size: 1.2rem;
            text-transform: uppercase;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: opacity 0.3s;
            margin-top: 20px;
        }

        button:hover {
            opacity: 0.8;
        }

        button.secondary-btn {
            background-color: white;
            color: black;
            border: 2px solid black;
        }

        /* Results Styling */
        #results-view {
            display: none;
            animation: fadeIn 1s;
        }

        .score-card {
            border: 2px solid black;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            background: #f9f9f9;
        }

        .big-score {
            font-size: 4rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .status-text {
            color: #444;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .metric-item {
            margin-bottom: 20px;
        }

        .metric-label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .metric-bar-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bg {
            flex-grow: 1;
            height: 10px;
            background-color: var(--accent-color);
        }

        .progress-fill {
            height: 100%;
            background-color: var(--bar-color);
            width: 0%;
            transition: width 1s ease-out;
        }

        .metric-value {
            font-weight: bold;
            min-width: 30px;
        }

        .metric-summary {
            font-size: 0.8rem;
            color: #444;
            margin-top: 3px;
            font-style: italic;
        }

        /* Canvas hidden used for generation */
        #certCanvas {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <div>
            <h1>Performance Metrics</h1>
            <p>EVALUATION PROTOCOL // V.2.0</p>
        </div>
        <div style="text-align: right; font-size: 0.8rem;">
            SECURE CONNECTION<br>
            <span id="date-display"></span>
        </div>
    </div>

    <div id="quiz-view">
        <div class="agent-input-group">
            <label for="agent-name">IDENTITY:</label>
            <input type="text" id="agent-name" placeholder="ENTER AGENT NAME" autocomplete="off">
        </div>

        <p>INSTRUCTIONS: Rate strictly from 1 (Negative) to 5 (Positive).</p>
        <form id="eval-form">
            <div id="questions-container"></div>
            <button type="button" id="submit-btn" onclick="calculateResults()">GENERATE ANALYSIS</button>
        </form>
    </div>

    <div id="results-view">
        <div class="score-card">
            <h3>Overall Performance</h3>
            <div class="big-score"><span id="total-score">0</span>/100</div>
            <div class="status-text" id="status-label">PENDING</div>
        </div>

        <div class="dashboard-grid">
            <div id="bars-container">
                </div>
            
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <div style="margin-top: 40px; display: grid; gap: 10px;">
            <button onclick="downloadCertificate()" style="background-color: black; color: white;">[ DOWNLOAD OFFICIAL CERTIFICATE ]</button>
            <button onclick="location.reload()" class="secondary-btn">[ RESET PROTOCOL ]</button>
        </div>
    </div>
</div>

<canvas id="certCanvas" width="800" height="600"></canvas>

<script>
    // INIT DATE
    document.getElementById('date-display').innerText = new Date().toLocaleDateString();

    // DATA CONFIGURATION
    const categories = [
        { id: 'acp', name: 'Anomaly Containment', full: 'Anomaly Containment Proficiency', questions: [
            "Je maîtrise l'utilisation des équipements de neutralisation de champ (chambres de vide, ancres de réalité, cages de Faraday).",
            "En cas de brèche, ma première réaction est de sécuriser le périmètre avant de tenter une approche.",
            "Je peux identifier visuellement les signes de déstabilisation d'un confinement avant que l'alarme ne se déclenche.",
            "Je respecte scrupuleusement les distances de sécurité, même pour des anomalies de classe mineure.",
            "Je sais improviser un confinement de fortune avec les matériaux disponibles sur le terrain"
        ]},
        { id: 'rada', name: 'Research & Docs', full: 'Research And Documentation Accuracy', questions: [
            "Mes rapports ne contiennent aucune interprétation subjective, seulement des faits observables.",
            "Je note systématiquement l'heure, la température et les variables environnementales lors d'une observation.",
            "Je vérifie mes sources et mes données deux fois avant de valider un dossier de recherche.",
            "Je sais synthétiser des phénomènes complexes en schémas clairs et exploitables par mes supérieurs.",
            "Ma documentation est si précise qu'un agent tiers pourrait reprendre ma mission sans aucune explication orale."
        ]},
        { id: 'cmc', name: 'Crisis Management', full: 'Crisis Management Capability', questions: [
            "Je reste capable de réciter des protocoles complexes alors qu'une alarme de niveau critique retentit.",
            "Je n'éprouve pas de (gel) (sidération) face à une menace visuelle terrifiante.",
            "Je sais prioriser les vies humaines par rapport au matériel, ou inversement, selon l'importance de la mission.",
            "Je prends des décisions claires en moins de 3 secondes dans le chaos.",
            "Après une crise, je suis capable de fournir un débriefing cohérent sans être altéré par le choc."
        ]},
        { id: 'osa', name: 'Operational Security', full: 'Operational Security Adherence', questions: [
            "Je ne discute jamais de mon travail en dehors des zones sécurisées (même avec mes proches).",
            "Je porte mes équipements de protection (EPI) et mes badges d'identification en permanence.",
            "Je signale immédiatement toute anomalie de comportement chez un collègue, sans hésitation sociale.",
            "Je ne branche jamais de périphérique externe inconnu sur le réseau de l'agence.",
            "Je respecte la hiérarchie et les niveaux d'accréditation sans chercher à en savoir plus que nécessaire.."
        ]},
        { id: 'iacs', name: 'Communication', full: 'Interpersonal And Communication Skills', questions: [
            "Mes subordonnés ou collègues comprennent mes ordres dès la première formulation.",
            "Je sais désamorcer les conflits internes avant qu'ils n'impactent l'efficacité du groupe.",
            "J'adapte mon langage (technique ou vulgarisé) en fonction de mon interlocuteur.",
            "Je sais écouter les alertes venant de mes équipiers, même s'ils sont moins gradés que moi.",
            "Je transmets les mauvaises nouvelles de manière factuelle et sans panique."
        ]},
        { id: 'iaai', name: 'Adaptability', full: 'Innovation And Adaptability Index', questions: [
            "Face à un problème sans solution prévue par le manuel, je trouve une alternative viable.",
            "J'apprends à utiliser de nouveaux outils ou logiciels en une fraction du temps requis.",
            "Je sais anticiper les mouvements d'un adversaire ou d'une anomalie en comprenant sa logique interne.",
            "Je ne suis pas déstabilisé si ma mission change radicalement en cours d'exécution.",
            "Je propose régulièrement des améliorations pour les procédures existantes."
        ]}
    ];

    // GENERATE QUIZ
    const container = document.getElementById('questions-container');
    categories.forEach((cat, index) => {
        let sectionHTML = `<div class="category-section"><h3>${cat.id.toUpperCase()} // ${cat.name}</h3>`;
        cat.questions.forEach((q, qIndex) => {
            sectionHTML += `
                <div class="question-row">
                    <div style="margin-bottom:5px;">${q}</div>
                    <div class="scale-selector">
                        <label><input type="radio" name="${cat.id}_${qIndex}" value="1"> 1</label>
                        <label><input type="radio" name="${cat.id}_${qIndex}" value="2"> 2</label>
                        <label><input type="radio" name="${cat.id}_${qIndex}" value="3"> 3</label>
                        <label><input type="radio" name="${cat.id}_${qIndex}" value="4"> 4</label>
                        <label><input type="radio" name="${cat.id}_${qIndex}" value="5"> 5</label>
                    </div>
                </div>`;
        });
        sectionHTML += `</div>`;
        container.innerHTML += sectionHTML;
    });

    // GLOBAL VARS FOR CERTIFICATE
    let finalScoreGlobal = 0;
    let finalStatusGlobal = "";
    let agentNameGlobal = "";

    function calculateResults() {
        // Get Name
        const nameInput = document.getElementById('agent-name').value;
        agentNameGlobal = nameInput ? nameInput : "REDACTED AGENT";

        let totalScoreSum = 0;
        let catScores = [];
        let labels = [];

        // Validation Check
        const inputs = document.querySelectorAll('input[type="radio"]:checked');
        if(inputs.length < categories.length * 5) {
            alert("ERREUR: Données incomplètes. Veuillez répondre à toutes les questions.");
            return;
        }

        document.getElementById('bars-container').innerHTML = '';

        categories.forEach(cat => {
            let catSum = 0;
            for(let i=0; i<5; i++) {
                catSum += parseInt(document.querySelector(`input[name="${cat.id}_${i}"]:checked`).value);
            }
            const percentage = (catSum / 25) * 100;
            catScores.push(percentage);
            totalScoreSum += percentage;
            labels.push(cat.id.toUpperCase());

            const barHTML = `
                <div class="metric-item">
                    <span class="metric-label">${cat.full}</span>
                    <div class="metric-bar-container">
                        <div class="progress-bg"><div class="progress-fill" style="width: ${percentage}%"></div></div>
                        <span class="metric-value">${percentage}</span>
                    </div>
                </div>`;
            document.getElementById('bars-container').innerHTML += barHTML;
        });

        finalScoreGlobal = Math.round(totalScoreSum / 6);
        document.getElementById('total-score').innerText = finalScoreGlobal;

        if(finalScoreGlobal >= 95) finalStatusGlobal = "CLASSE 1";
        else if(finalScoreGlobal >= 85) finalStatusGlobal = "CLASSE 2";
        else if(finalScoreGlobal >= 70) finalStatusGlobal = "CLASSE 3";
        else if(finalScoreGlobal >= 50) finalStatusGlobal = "CLASSE 4";
        else finalStatusGlobal = "CRITICAL FAILURE";
        
        document.getElementById('status-label').innerText = finalStatusGlobal;
        document.getElementById('quiz-view').style.display = 'none';
        document.getElementById('results-view').style.display = 'block';

        renderChart(labels, catScores);
        window.scrollTo(0,0);
    }

    function renderChart(labels, data) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Proficiency',
                    data: data,
                    backgroundColor: 'rgba(0, 0, 0, 0.2)',
                    borderColor: 'rgba(0, 0, 0, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'black'
                }]
            },
            options: {
                scales: {
                    r: {
                        angleLines: { color: '#ccc' },
                        grid: { color: '#e0e0e0' },
                        suggestedMin: 0, suggestedMax: 100,
                        ticks: { display: false }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    // CERTIFICATE GENERATION
    function downloadCertificate() {
        const canvas = document.getElementById('certCanvas');
        const ctx = canvas.getContext('2d');
        
        // Background
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, 800, 600);
        
        // Borders
        ctx.lineWidth = 10;
        ctx.strokeStyle = "#000000";
        ctx.strokeRect(20, 20, 760, 560);
        
        ctx.lineWidth = 2;
        ctx.strokeRect(35, 35, 730, 530);

        // Header
        ctx.fillStyle = "#000000";
        ctx.font = "bold 40px 'Courier New'";
        ctx.textAlign = "center";
        ctx.fillText("OFFICIAL EVALUATION PEM", 400, 100);
        
        ctx.fillRect(100, 120, 600, 5); // Line under title

        // Content Info
        ctx.textAlign = "left";
        ctx.font = "bold 25px 'Courier New'";
        
        const startX = 100;
        let startY = 200;
        const spacing = 50;

        ctx.fillText(`AGENT IDENTITY : ${agentNameGlobal.toUpperCase()}`, startX, startY);
        ctx.fillText(`DATE           : ${new Date().toLocaleDateString()}`, startX, startY + spacing);
        ctx.fillText(`LOCATION       : CLASSIFIED`, startX, startY + spacing * 2);
        
        // Score Box
        ctx.strokeRect(startX, startY + spacing * 3, 600, 150);
        
        ctx.font = "20px 'Courier New'";
        ctx.fillText("OVERALL PERFORMANCE INDEX:", startX + 20, startY + spacing * 3 + 40);
        
        ctx.font = "bold 60px 'Courier New'";
        ctx.fillText(`${finalScoreGlobal}/100`, startX + 20, startY + spacing * 3 + 110);
        
        // Status Stamp
        ctx.save();
        ctx.translate(500, startY + spacing * 3 + 80);
        ctx.rotate(-0.2);
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 5;
        ctx.strokeRect(-100, -30, 200, 60);
        ctx.font = "bold 30px 'Courier New'";
        ctx.textAlign = "center";
        ctx.fillStyle = "#000000";
        ctx.fillText(finalStatusGlobal.split(' ')[0], 0, 10);
        ctx.restore();

        // Footer
        ctx.font = "italic 15px 'Courier New'";
        ctx.textAlign = "center";
        ctx.fillText("This document is classified. Unauthorized distribution is lethal.", 400, 560);

        // Download Trigger
        const link = document.createElement('a');
        link.download = `CERTIFICATE_${agentNameGlobal.replace(/\s+/g, '_')}.png`;
        link.href = canvas.toDataURL();
        link.click();
    }
</script>

</body>
</html>